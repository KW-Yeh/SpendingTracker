module.exports=[24868,(e,r,s)=>{r.exports=e.x("fs/promises",()=>require("fs/promises"))},23897,32961,e=>{"use strict";var r=e.i(24868),s=e.i(54799),o=e.i(14747),t=e.i(65790);let i=e=>{let r=(0,s.createHash)("sha1").update(e).digest("hex");return(0,o.join)((0,t.getHomeDir)(),".aws","sso","cache",`${r}.json`)};e.s(["getSSOTokenFilepath",0,i],32961);let n={},a=async e=>{if(n[e])return n[e];let s=i(e);return JSON.parse(await (0,r.readFile)(s,"utf8"))};e.s(["getSSOTokenFromFile",0,a,"tokenIntercept",0,n],23897)},22734,(e,r,s)=>{r.exports=e.x("fs",()=>require("fs"))},26709,e=>{"use strict";e.s([],23957),e.i(23957);var r=e.i(60400),s=e.i(81355),o=e.i(92395),t=e.i(96405),i=e.i(3289);let n=e=>Object.entries(e).filter(([e])=>e.startsWith(t.IniSectionType.SSO_SESSION+i.CONFIG_PREFIX_SEPARATOR)).reduce((e,[r,s])=>({...e,[r.substring(r.indexOf(i.CONFIG_PREFIX_SEPARATOR)+1)]:s}),{});var a=e.i(7104),l=e.i(49487);let c=()=>({}),g=async(e={})=>(0,l.readFile)(e.configFilepath??(0,o.getConfigFilepath)()).then(a.parseIni).then(n).catch(c);var f=e.i(76535);let d=e=>e&&("string"==typeof e.sso_start_url||"string"==typeof e.sso_account_id||"string"==typeof e.sso_session||"string"==typeof e.sso_region||"string"==typeof e.sso_role_name);e.s(["isSsoProfile",0,d],70487);var h=e.i(9212),p=e.i(48979);class _ extends p.ProviderError{name="TokenProviderError";constructor(e,r=!0){super(e,r),Object.setPrototypeOf(this,_.prototype)}}var u=e.i(23897);let w="To refresh this SSO session run 'aws sso login' with the corresponding profile.",S=async(r,s={},o)=>{let{SSOOIDCClient:t}=await e.A(57227),i=e=>s.clientConfig?.[e]??s.parentClientConfig?.[e]??o?.[e];return new t(Object.assign({},s.clientConfig??{},{region:r??s.clientConfig?.region,logger:i("logger"),userAgentAppId:i("userAgentAppId")}))},k=async(r,s,o={},t)=>{let{CreateTokenCommand:i}=await e.A(57227);return(await S(s,o,t)).send(new i({clientId:r.clientId,clientSecret:r.clientSecret,refreshToken:r.refreshToken,grantType:"refresh_token"}))},C=e=>{if(e.expiration&&e.expiration.getTime()<Date.now())throw new _(`Token is expired. ${w}`,!1)},v=(e,r,s=!1)=>{if(void 0===r)throw new _(`Value not present for '${e}' in SSO Token${s?". Cannot refresh":""}. ${w}`,!1)};var m=e.i(32961);let{writeFile:O}=e.i(22734).promises,T=new Date(0),y=async({ssoStartUrl:o,ssoSession:t,ssoAccountId:i,ssoRegion:n,ssoRoleName:a,ssoClient:l,clientConfig:c,parentClientConfig:d,callerClientConfig:p,profile:S,filepath:y,configFilepath:x,ignoreCache:P,logger:A})=>{let I,F,E="To refresh this SSO session run aws sso login with the corresponding profile.";if(t)try{let e=await ((e={})=>async({callerClientConfig:r}={})=>{let o;e.logger?.debug("@aws-sdk/token-providers - fromSso");let t=await (0,f.parseKnownFiles)(e),i=(0,s.getProfileName)({profile:e.profile??r?.profile}),n=t[i];if(n){if(!n.sso_session)throw new _(`Profile '${i}' is missing required property 'sso_session'.`)}else throw new _(`Profile '${i}' could not be found in shared credentials file.`,!1);let a=n.sso_session,l=(await g(e))[a];if(!l)throw new _(`Sso session '${a}' could not be found in shared credentials file.`,!1);for(let e of["sso_start_url","sso_region"])if(!l[e])throw new _(`Sso session '${a}' is missing required property '${e}'.`,!1);l.sso_start_url;let c=l.sso_region;try{o=await (0,u.getSSOTokenFromFile)(a)}catch(e){throw new _(`The SSO session token associated with profile=${i} was not found or is invalid. ${w}`,!1)}v("accessToken",o.accessToken),v("expiresAt",o.expiresAt);let{accessToken:d,expiresAt:h}=o,p={token:d,expiration:new Date(h)};if(p.expiration.getTime()-Date.now()>3e5)return p;if(Date.now()-T.getTime()<3e4)return C(p),p;v("clientId",o.clientId,!0),v("clientSecret",o.clientSecret,!0),v("refreshToken",o.refreshToken,!0);try{T.setTime(Date.now());let s=await k(o,c,e,r);v("accessToken",s.accessToken),v("expiresIn",s.expiresIn);let t=new Date(Date.now()+1e3*s.expiresIn);try{var S;let e;await (S={...o,accessToken:s.accessToken,expiresAt:t.toISOString(),refreshToken:s.refreshToken},e=(0,m.getSSOTokenFilepath)(a),O(e,JSON.stringify(S,null,2)))}catch(e){}return{token:s.accessToken,expiration:t}}catch(e){return C(p),p}})({profile:S,filepath:y,configFilepath:x,ignoreCache:P})();I={accessToken:e.token,expiresAt:new Date(e.expiration).toISOString()}}catch(e){throw new r.CredentialsProviderError(e.message,{tryNextLink:!1,logger:A})}else try{I=await (0,u.getSSOTokenFromFile)(o)}catch(e){throw new r.CredentialsProviderError(`The SSO session associated with this profile is invalid. ${E}`,{tryNextLink:!1,logger:A})}if(new Date(I.expiresAt).getTime()-Date.now()<=0)throw new r.CredentialsProviderError(`The SSO session associated with this profile has expired. ${E}`,{tryNextLink:!1,logger:A});let{accessToken:N}=I,{SSOClient:j,GetRoleCredentialsCommand:$}=await e.A(94624),b=l||new j(Object.assign({},c??{},{logger:c?.logger??p?.logger??d?.logger,region:c?.region??n,userAgentAppId:c?.userAgentAppId??p?.userAgentAppId??d?.userAgentAppId}));try{F=await b.send(new $({accountId:i,roleName:a,accessToken:N}))}catch(e){throw new r.CredentialsProviderError(e,{tryNextLink:!1,logger:A})}let{roleCredentials:{accessKeyId:R,secretAccessKey:D,sessionToken:L,expiration:q,credentialScope:G,accountId:J}={}}=F;if(!R||!D||!L||!q)throw new r.CredentialsProviderError("SSO returns an invalid temporary credential.",{tryNextLink:!1,logger:A});let H={accessKeyId:R,secretAccessKey:D,sessionToken:L,expiration:new Date(q),...G&&{credentialScope:G},...J&&{accountId:J}};return t?(0,h.setCredentialFeature)(H,"CREDENTIALS_SSO","s"):(0,h.setCredentialFeature)(H,"CREDENTIALS_SSO_LEGACY","u"),H},x=(e,s)=>{let{sso_start_url:o,sso_account_id:t,sso_region:i,sso_role_name:n}=e;if(!o||!t||!i||!n)throw new r.CredentialsProviderError(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(e).join(", ")}
Reference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,{tryNextLink:!1,logger:s});return e};e.s(["validateSsoProfile",0,x],61980);let P=(e={})=>async({callerClientConfig:o}={})=>{e.logger?.debug("@aws-sdk/credential-provider-sso - fromSSO");let{ssoStartUrl:t,ssoAccountId:i,ssoRegion:n,ssoRoleName:a,ssoSession:l}=e,{ssoClient:c}=e,h=(0,s.getProfileName)({profile:e.profile??o?.profile});if(t||i||n||a||l)if(t&&i&&n&&a)return y({ssoStartUrl:t,ssoSession:l,ssoAccountId:i,ssoRegion:n,ssoRoleName:a,ssoClient:c,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,callerClientConfig:e.callerClientConfig,profile:h,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger});else throw new r.CredentialsProviderError('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"',{tryNextLink:!1,logger:e.logger});{let s=(await (0,f.parseKnownFiles)(e))[h];if(!s)throw new r.CredentialsProviderError(`Profile ${h} was not found.`,{logger:e.logger});if(!d(s))throw new r.CredentialsProviderError(`Profile ${h} is not configured with SSO credentials.`,{logger:e.logger});if(s?.sso_session){let o=(await g(e))[s.sso_session],i=` configurations in profile ${h} and sso-session ${s.sso_session}`;if(n&&n!==o.sso_region)throw new r.CredentialsProviderError("Conflicting SSO region"+i,{tryNextLink:!1,logger:e.logger});if(t&&t!==o.sso_start_url)throw new r.CredentialsProviderError("Conflicting SSO start_url"+i,{tryNextLink:!1,logger:e.logger});s.sso_region=o.sso_region,s.sso_start_url=o.sso_start_url}let{sso_start_url:o,sso_account_id:i,sso_region:a,sso_role_name:l,sso_session:p}=x(s,e.logger);return y({ssoStartUrl:o,ssoSession:p,ssoAccountId:i,ssoRegion:a,ssoRoleName:l,ssoClient:c,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,callerClientConfig:e.callerClientConfig,profile:h,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger})}};e.s(["fromSSO",0,P],75670),e.i(75670),e.i(70487),e.s([],10105),e.i(10105),e.i(61980),e.s(["fromSSO",0,P,"isSsoProfile",0,d,"validateSsoProfile",0,x],26709)},57227,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__8a78c030._.js","server/chunks/[root-of-the-server]__661f6766._.js","server/chunks/[root-of-the-server]__d05a396c._.js","server/chunks/a9bf9_@aws-sdk_core_dist-es_submodules_protocols_json_AwsRestJsonProtocol_764d7a83.js","server/chunks/node_modules_@aws-sdk_nested-clients_dist-es_submodules_sso-oidc_index_df09d547.js"].map(r=>e.l(r))).then(()=>r(86799)))},94624,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__b1b87a22._.js","server/chunks/[root-of-the-server]__661f6766._.js","server/chunks/[root-of-the-server]__6aec73bd._.js","server/chunks/node_modules_@aws-sdk_6f97efc0._.js","server/chunks/a9bf9_@aws-sdk_core_dist-es_submodules_protocols_json_AwsRestJsonProtocol_764d7a83.js"].map(r=>e.l(r))).then(()=>r(56690)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a46c0411._.js.map