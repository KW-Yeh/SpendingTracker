module.exports=[1270,a=>{"use strict";var b=a.i(87924);a.s(["Loading",0,a=>(0,b.jsxs)("svg",{className:"-ml-1 mr-3 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",...a,children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})])},85250,a=>{"use strict";var b=a.i(87924),c=a.i(1270),d=a.i(10584),e=a.i(90419),f=a.i(18402),g=a.i(50944),h=a.i(72131);a.s(["InviteConfirm",0,()=>{let{id:a}=(0,g.useParams)(),i=(0,g.useRouter)(),{config:j,loading:k}=(0,e.useUserConfigCtx)(),{syncGroup:l,groups:m}=(0,d.useGroupCtx)(),[n,o]=(0,h.useState)(null),[p,q]=(0,h.useState)(!0),[r,s]=(0,h.useState)(null);(0,h.useEffect)(()=>{if(!a){s("無效的邀請連結"),q(!1);return}fetch(`/api/aurora/groups?id=${a}&type=single`).then(a=>a.json()).then(a=>{a&&a.length>0?o(a[0]):s("找不到該群組")}).catch(a=>{console.error("查詢群組失敗:",a),s("查詢群組失敗，請稍後再試")}).finally(()=>{q(!1)})},[a]);let t=(0,h.useCallback)(()=>{let a=window.location.pathname;(0,f.signIn)(void 0,{callbackUrl:a})},[]),u=(0,h.useCallback)(async()=>{if(!j?.user_id||!n?.account_id)return void alert("無法加入群組，缺少必要資訊");if(m.some(a=>a.account_id===n.account_id)){alert("您已經是該群組的成員了"),i.push("/group");return}q(!0);try{if(!(await fetch("/api/aurora/group/member",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account_id:n.account_id,user_id:j.user_id,role:"Viewer"})})).ok)throw Error("Failed to add group member");await l(j.user_id),alert("成功加入群組！"),i.push("/group")}catch(a){console.error("加入群組失敗:",a),alert("加入群組失敗，請稍後再試")}finally{q(!1)}},[j,n,m,l,i]);return p||k?(0,b.jsx)("div",{className:"m-auto",children:(0,b.jsx)(c.Loading,{className:"text-text size-10 animate-spin"})}):r||!n?(0,b.jsxs)("div",{className:"bg-background flex w-80 flex-col rounded-2xl border border-solid border-red-300 p-6 text-center shadow",children:[(0,b.jsx)("p",{className:"text-red-500",children:r||"無法載入群組資訊"}),(0,b.jsx)("button",{type:"button",onClick:()=>i.push("/group"),className:"mt-4 rounded bg-gray-500 px-4 py-2 text-white hover:bg-gray-600",children:"返回群組頁面"})]}):j?.user_id?(0,b.jsxs)("div",{className:"bg-background flex w-80 flex-col rounded-2xl border border-solid border-gray-300 pt-5 pb-4 shadow",children:[(0,b.jsxs)("h1",{className:"mb-6 w-full px-5 text-start text-lg sm:text-xl",children:["是否加入",(0,b.jsx)("strong",{className:"ml-2 font-bold",children:n.name}),"帳本？"]}),(0,b.jsxs)("div",{className:"px-5 pb-4",children:[(0,b.jsx)("p",{className:"mb-2 text-sm text-gray-600",children:"帳本資訊："}),(0,b.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3 text-sm",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-medium",children:"擁有者："}),n.owner_name||n.owner_email||"未知"]}),(0,b.jsxs)("p",{className:"mt-1",children:[(0,b.jsx)("span",{className:"font-medium",children:"成員數量："}),n.member_count||0," 人"]})]}),(0,b.jsxs)("p",{className:"mt-3 text-xs text-gray-500",children:["加入後您將成為 ",(0,b.jsx)("strong",{children:"Viewer"}),"（檢視者）角色"]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 border-t border-solid border-gray-300 px-4 pt-4",children:[(0,b.jsx)("button",{type:"button",onClick:()=>i.push("/group"),className:"active:text-background hover:text-background rounded border border-solid border-red-500 px-6 py-1 text-red-500 transition-colors hover:bg-red-500 active:bg-red-500",children:"取消"}),(0,b.jsx)("button",{type:"button",onClick:u,disabled:p,className:"text-background rounded border border-solid border-green-500 bg-green-500 px-6 py-1 transition-colors hover:border-green-400 hover:bg-green-400 active:border-green-400 active:bg-green-400 disabled:cursor-not-allowed disabled:bg-gray-400 disabled:border-gray-400",children:p?"加入中...":"加入"})]})]}):(0,b.jsxs)("div",{className:"bg-background flex w-80 flex-col rounded-2xl border border-solid border-blue-300 p-6 text-center shadow",children:[(0,b.jsx)("h2",{className:"mb-4 text-lg font-bold",children:"需要登入"}),(0,b.jsxs)("p",{className:"mb-2 text-gray-600",children:["您收到了加入帳本",(0,b.jsx)("strong",{className:"mx-1 text-blue-600",children:n.name}),"的邀請"]}),(0,b.jsx)("p",{className:"mb-6 text-sm text-gray-500",children:"請先登入以繼續加入帳本"}),(0,b.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:t,className:"rounded bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-600",children:"前往登入"}),(0,b.jsx)("button",{type:"button",onClick:()=>i.push("/"),className:"text-sm text-gray-500 hover:text-gray-700",children:"返回首頁"})]})]})}])}];

//# sourceMappingURL=src_f183f045._.js.map