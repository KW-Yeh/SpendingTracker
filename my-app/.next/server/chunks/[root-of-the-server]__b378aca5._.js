module.exports=[2157,(e,r,t)=>{r.exports=e.x("node:fs",()=>require("node:fs"))},76535,e=>{"use strict";var r=e.i(46277);let t=async e=>{let t=await (0,r.loadSharedConfigFiles)(e);return((...e)=>{let r={};for(let t of e)for(let[e,s]of Object.entries(t))void 0!==r[e]?Object.assign(r[e],s):r[e]=s;return r})(t.configFile,t.credentialsFile)};e.s(["parseKnownFiles",0,t],76535)},66680,(e,r,t)=>{r.exports=e.x("node:crypto",()=>require("node:crypto"))},60526,(e,r,t)=>{r.exports=e.x("node:os",()=>require("node:os"))},50227,(e,r,t)=>{r.exports=e.x("node:path",()=>require("node:path"))},1346,e=>{"use strict";e.s([],58014),e.i(58014);var r=e.i(81355),t=e.i(76535),s=e.i(60400),n=e.i(9212),i=e.i(39866);let o=e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p"),a=async(t,a,c,d,f={},u)=>{c.logger?.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");let g=a[t],{source_profile:_,region:h}=g;if(!c.roleAssumer){let{getDefaultRoleAssumer:r}=await e.A(43109);c.roleAssumer=r({...c.clientConfig,credentialProviderLogger:c.logger,parentClientConfig:{...d,...c?.parentClientConfig,region:h??c?.parentClientConfig?.region??d?.region}},c.clientPlugins)}if(_&&_ in f)throw new s.CredentialsProviderError(`Detected a cycle attempting to resolve credentials for profile ${(0,r.getProfileName)(c)}. Profiles visited: `+Object.keys(f).join(", "),{logger:c.logger});c.logger?.debug(`@aws-sdk/credential-provider-ini - finding credential resolver using ${_?`source_profile=[${_}]`:`profile=[${t}]`}`);let p=_?u(_,a,c,d,{...f,[_]:!0},l(a[_]??{})):(await ((r,t,n)=>{let a={EcsContainer:async r=>{let{fromHttp:t}=await e.A(93306),{fromContainerMetadata:s}=await e.A(14277);return n?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>(0,i.chain)(t(r??{}),s(r))().then(o)},Ec2InstanceMetadata:async r=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");let{fromInstanceMetadata:t}=await e.A(14277);return async()=>t(r)().then(o)},Environment:async r=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");let{fromEnv:t}=await e.A(31605);return async()=>t(r)().then(o)}};if(r in a)return a[r];throw new s.CredentialsProviderError(`Unsupported credential source in profile ${t}. Got ${r}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger:n})})(g.credential_source,t,c.logger)(c))();if(l(g))return p.then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));{let e={RoleArn:g.role_arn,RoleSessionName:g.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:g.external_id,DurationSeconds:parseInt(g.duration_seconds||"3600",10)},{mfa_serial:r}=g;if(r){if(!c.mfaCodeProvider)throw new s.CredentialsProviderError(`Profile ${t} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:c.logger,tryNextLink:!1});e.SerialNumber=r,e.TokenCode=await c.mfaCodeProvider(r)}let i=await p;return c.roleAssumer(i,e).then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},l=e=>!e.role_arn&&!!e.credential_source;var c=e.i(89073),d=e.i(49487),f=e.i(66680),u=e.i(2157),g=e.i(60526),_=e.i(50227);class h{profileData;init;callerClientConfig;static REFRESH_THRESHOLD=3e5;constructor(e,r,t){this.profileData=e,this.init=r,this.callerClientConfig=t}async loadCredentials(){let e=await this.loadToken();if(!e)throw new s.CredentialsProviderError(`Failed to load a token for session ${this.loginSession}, please re-authenticate using aws login`,{tryNextLink:!1,logger:this.logger});let r=e.accessToken,t=Date.now();return new Date(r.expiresAt).getTime()-t<=h.REFRESH_THRESHOLD?this.refresh(e):{accessKeyId:r.accessKeyId,secretAccessKey:r.secretAccessKey,sessionToken:r.sessionToken,accountId:r.accountId,expiration:new Date(r.expiresAt)}}get logger(){return this.init?.logger}get loginSession(){return this.profileData.login_session}async refresh(r){let t,{SigninClient:n,CreateOAuth2TokenCommand:i}=await e.A(54608),{logger:o,userAgentAppId:a}=this.callerClientConfig??{},l=(t=this.callerClientConfig?.requestHandler,t?.metadata?.handlerProtocol==="h2")?void 0:this.callerClientConfig?.requestHandler,c=new n({credentials:{accessKeyId:"",secretAccessKey:""},region:this.profileData.region??await this.callerClientConfig?.region?.()??process.env.AWS_REGION,requestHandler:l,logger:o,userAgentAppId:a,...this.init?.clientConfig});this.createDPoPInterceptor(c.middlewareStack);let d={tokenInput:{clientId:r.clientId,refreshToken:r.refreshToken,grantType:"refresh_token"}};try{let e=await c.send(new i(d)),{accessKeyId:t,secretAccessKey:n,sessionToken:o}=e.tokenOutput?.accessToken??{},{refreshToken:a,expiresIn:l}=e.tokenOutput??{};if(!t||!n||!o||!a)throw new s.CredentialsProviderError("Token refresh response missing required fields",{logger:this.logger,tryNextLink:!1});let f=new Date(Date.now()+(l??900)*1e3),u={...r,accessToken:{...r.accessToken,accessKeyId:t,secretAccessKey:n,sessionToken:o,expiresAt:f.toISOString()},refreshToken:a};await this.saveToken(u);let g=u.accessToken;return{accessKeyId:g.accessKeyId,secretAccessKey:g.secretAccessKey,sessionToken:g.sessionToken,accountId:g.accountId,expiration:f}}catch(e){if("AccessDeniedException"===e.name){let r;switch(e.error){case"TOKEN_EXPIRED":r="Your session has expired. Please reauthenticate.";break;case"USER_CREDENTIALS_CHANGED":r="Unable to refresh credentials because of a change in your password. Please reauthenticate with your new password.";break;case"INSUFFICIENT_PERMISSIONS":r="Unable to refresh credentials due to insufficient permissions. You may be missing permission for the 'CreateOAuth2Token' action.";break;default:r=`Failed to refresh token: ${String(e)}. Please re-authenticate using \`aws login\``}throw new s.CredentialsProviderError(r,{logger:this.logger,tryNextLink:!1})}throw new s.CredentialsProviderError(`Failed to refresh token: ${String(e)}. Please re-authenticate using aws login`,{logger:this.logger})}}async loadToken(){let e=this.getTokenFilePath();try{let r;try{r=await (0,d.readFile)(e,{ignoreCache:this.init?.ignoreCache})}catch{r=await u.promises.readFile(e,"utf8")}let t=JSON.parse(r),n=["accessToken","clientId","refreshToken","dpopKey"].filter(e=>!t[e]);if(t.accessToken?.accountId||n.push("accountId"),n.length>0)throw new s.CredentialsProviderError(`Token validation failed, missing fields: ${n.join(", ")}`,{logger:this.logger,tryNextLink:!1});return t}catch(r){throw new s.CredentialsProviderError(`Failed to load token from ${e}: ${String(r)}`,{logger:this.logger,tryNextLink:!1})}}async saveToken(e){let r=this.getTokenFilePath(),t=(0,_.dirname)(r);try{await u.promises.mkdir(t,{recursive:!0})}catch(e){}await u.promises.writeFile(r,JSON.stringify(e,null,2),"utf8")}getTokenFilePath(){let e=process.env.AWS_LOGIN_CACHE_DIRECTORY??(0,_.join)((0,g.homedir)(),".aws","login","cache"),r=Buffer.from(this.loginSession,"utf8"),t=(0,f.createHash)("sha256").update(r).digest("hex");return(0,_.join)(e,`${t}.json`)}derToRawSignature(e){let r=2;if(2!==e[2])throw Error("Invalid DER signature");r++;let t=e[r++],s=e.subarray(r,r+t);if(2!==e[r+=t])throw Error("Invalid DER signature");r++;let n=e[r++],i=e.subarray(r,r+n);s=0===s[0]?s.subarray(1):s,i=0===i[0]?i.subarray(1):i;let o=Buffer.concat([Buffer.alloc(32-s.length),s]),a=Buffer.concat([Buffer.alloc(32-i.length),i]);return Buffer.concat([o,a])}createDPoPInterceptor(e){e.add(e=>async r=>{if(c.HttpRequest.isInstance(r.request)){let e=r.request,t=`${e.protocol}//${e.hostname}${e.port?`:${e.port}`:""}${e.path}`,s=await this.generateDpop(e.method,t);e.headers={...e.headers,DPoP:s}}return e(r)},{step:"finalizeRequest",name:"dpopInterceptor",override:!0})}async generateDpop(e="POST",r){let t=await this.loadToken();try{let s=(0,f.createPrivateKey)({key:t.dpopKey,format:"pem",type:"sec1"}),n=(0,f.createPublicKey)(s).export({format:"der",type:"spki"}),i=-1;for(let e=0;e<n.length;e++)if(4===n[e]){i=e;break}let o=n.slice(i+1,i+33),a=n.slice(i+33,i+65),l={alg:"ES256",typ:"dpop+jwt",jwk:{kty:"EC",crv:"P-256",x:o.toString("base64url"),y:a.toString("base64url")}},c={jti:crypto.randomUUID(),htm:e,htu:r,iat:Math.floor(Date.now()/1e3)},d=Buffer.from(JSON.stringify(l)).toString("base64url"),u=Buffer.from(JSON.stringify(c)).toString("base64url"),g=`${d}.${u}`,_=(0,f.sign)("sha256",Buffer.from(g),s),h=this.derToRawSignature(_).toString("base64url");return`${g}.${h}`}catch(e){throw new s.CredentialsProviderError(`Failed to generate Dpop proof: ${e instanceof Error?e.message:String(e)}`,{logger:this.logger,tryNextLink:!1})}}}let p=async(e,i,o)=>{let a,l=await (a={...i,profile:e},async({callerClientConfig:e}={})=>{a?.logger?.debug?.("@aws-sdk/credential-providers - fromLoginCredentials");let i=await (0,t.parseKnownFiles)(a||{}),o=(0,r.getProfileName)({profile:a?.profile??e?.profile}),l=i[o];if(!l?.login_session)throw new s.CredentialsProviderError(`Profile ${o} does not contain login_session.`,{tryNextLink:!0,logger:a?.logger});let c=new h(l,a,e),d=await c.loadCredentials();return(0,n.setCredentialFeature)(d,"CREDENTIALS_LOGIN","AD")})({callerClientConfig:o});return(0,n.setCredentialFeature)(l,"CREDENTIALS_PROFILE_LOGIN","AC")},w=async(r,t)=>e.A(85365).then(({fromProcess:e})=>e({...r,profile:t})().then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_PROCESS","v"))),y=async(r,t,s={},i)=>{let{fromSSO:o}=await e.A(14115);return o({profile:r,logger:s.logger,parentClientConfig:s.parentClientConfig,clientConfig:s.clientConfig})({callerClientConfig:i}).then(e=>t.sso_session?(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SSO","r"):(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SSO_LEGACY","t"))},k=e=>!!e&&"object"==typeof e&&"string"==typeof e.aws_access_key_id&&"string"==typeof e.aws_secret_access_key&&["undefined","string"].indexOf(typeof e.aws_session_token)>-1&&["undefined","string"].indexOf(typeof e.aws_account_id)>-1,C=async(e,r)=>{r?.logger?.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");let t={accessKeyId:e.aws_access_key_id,secretAccessKey:e.aws_secret_access_key,sessionToken:e.aws_session_token,...e.aws_credential_scope&&{credentialScope:e.aws_credential_scope},...e.aws_account_id&&{accountId:e.aws_account_id}};return(0,n.setCredentialFeature)(t,"CREDENTIALS_PROFILE","n")},v=async(r,t,s)=>e.A(52170).then(({fromTokenFile:e})=>e({webIdentityTokenFile:r.web_identity_token_file,roleArn:r.role_arn,roleSessionName:r.role_session_name,roleAssumerWithWebIdentity:t.roleAssumerWithWebIdentity,logger:t.logger,parentClientConfig:t.parentClientConfig})({callerClientConfig:s}).then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q"))),E=async(e,r,t,n,i={},o=!1)=>{let l=r[e];if(Object.keys(i).length>0&&k(l))return C(l,t);if(o||((e,{profile:r="default",logger:t}={})=>!!e&&"object"==typeof e&&"string"==typeof e.role_arn&&["undefined","string"].indexOf(typeof e.role_session_name)>-1&&["undefined","string"].indexOf(typeof e.external_id)>-1&&["undefined","string"].indexOf(typeof e.mfa_serial)>-1&&(((e,{profile:r,logger:t})=>{let s="string"==typeof e.source_profile&&void 0===e.credential_source;return s&&t?.debug?.(`    ${r} isAssumeRoleWithSourceProfile source_profile=${e.source_profile}`),s})(e,{profile:r,logger:t})||((e,{profile:r,logger:t})=>{let s="string"==typeof e.credential_source&&void 0===e.source_profile;return s&&t?.debug?.(`    ${r} isCredentialSourceProfile credential_source=${e.credential_source}`),s})(e,{profile:r,logger:t})))(l,{profile:e,logger:t.logger}))return a(e,r,t,n,i,E);if(k(l))return C(l,t);if(l&&"object"==typeof l&&"string"==typeof l.web_identity_token_file&&"string"==typeof l.role_arn&&["undefined","string"].indexOf(typeof l.role_session_name)>-1)return v(l,t,n);if(l&&"object"==typeof l&&"string"==typeof l.credential_process)return w(t,e);if(l&&("string"==typeof l.sso_start_url||"string"==typeof l.sso_account_id||"string"==typeof l.sso_session||"string"==typeof l.sso_region||"string"==typeof l.sso_role_name))return await y(e,l,t,n);if(l&&l.login_session)return p(e,t,n);throw new s.CredentialsProviderError(`Could not resolve credentials using profile: [${e}] in configuration/credentials file(s).`,{logger:t.logger})},m=(e={})=>async({callerClientConfig:s}={})=>{e.logger?.debug("@aws-sdk/credential-provider-ini - fromIni");let n=await (0,t.parseKnownFiles)(e);return E((0,r.getProfileName)({profile:e.profile??s?.profile}),n,e,s)};e.s(["fromIni",0,m],24518),e.i(24518),e.s(["fromIni",0,m],1346)},93306,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__045059a3._.js","server/chunks/[root-of-the-server]__a1bc4740._.js"].map(r=>e.l(r))).then(()=>r(38788)))},14277,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__56e7cf5d._.js"].map(r=>e.l(r))).then(()=>r(63152)))},31605,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_@aws-sdk_credential-provider-env_dist-es_index_55d96139.js"].map(r=>e.l(r))).then(()=>r(97301)))},43109,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__4ff77748._.js","server/chunks/[root-of-the-server]__661f6766._.js","server/chunks/[root-of-the-server]__10123f10._.js","server/chunks/node_modules_@aws-sdk_nested-clients_dist-es_submodules_sts_index_c78619b3.js"].map(r=>e.l(r))).then(()=>r(90222)))},54608,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__8a78c030._.js","server/chunks/[root-of-the-server]__661f6766._.js","server/chunks/[root-of-the-server]__d05a396c._.js","server/chunks/a9bf9_@aws-sdk_core_dist-es_submodules_protocols_json_AwsRestJsonProtocol_764d7a83.js","server/chunks/node_modules_@aws-sdk_nested-clients_dist-es_submodules_signin_index_6712dec9.js"].map(r=>e.l(r))).then(()=>r(20083)))},85365,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__763fc82b._.js"].map(r=>e.l(r))).then(()=>r(33073)))},14115,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__a46c0411._.js"].map(r=>e.l(r))).then(()=>r(26709)))},52170,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__9785bfd3._.js"].map(r=>e.l(r))).then(()=>r(23492)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__b378aca5._.js.map