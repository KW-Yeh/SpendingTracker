module.exports=[18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},70406,(e,r,t)=>{r.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},69427,e=>e.a(async(r,t)=>{try{var a=e.i(86174),s=r([a]);async function o(e){if(!e)throw Error("缺少 Email 資訊");console.log("[DB getUser] Querying user with email:",e);let r=await (0,a.getDb)(),t=`
    SELECT
      user_id,
      email,
      name,
      avatar_url,
      created_at
    FROM users
    WHERE email = $1
  `,s=await r.query(t,[e]);return(console.log("[DB getUser] Query result rows:",s.rows.length),0===s.rows.length)?(console.log("[DB getUser] ⚠️ No user found for email:",e),null):(console.log("[DB getUser] ✅ User found:",s.rows[0]),s.rows[0])}async function n(e){let{user_id:r,email:t,name:s}=e;if(console.log("[DB createUser] Creating user with data:",{user_id:r,email:t,name:s}),!r||!t)throw Error("缺少必要欄位");let o=await (0,a.getDb)(),n=`
    INSERT INTO users (user_id, email, name)
    VALUES ($1, $2, $3)
    ON CONFLICT (user_id) DO NOTHING
    RETURNING user_id, email, name, avatar_url, created_at
  `;console.log("[DB createUser] Executing INSERT query...");let i=await o.query(n,[r,t,s]);if(console.log("[DB createUser] Query result rows:",i.rows.length),0===i.rows.length)throw console.log("[DB createUser] ❌ User ID already exists:",r),Error("使用者 ID 已存在");return console.log("[DB createUser] ✅ User created successfully:",i.rows[0]),i.rows[0]}async function i(e,r){if(!e)throw Error("缺少使用者 ID");let t=await (0,a.getDb)(),s=[],o=[],n=1;if(void 0!==r.email&&(s.push(`email = $${n}`),o.push(r.email),n++),void 0!==r.name&&(s.push(`name = $${n}`),o.push(r.name),n++),void 0!==r.avatar_url&&(s.push(`avatar_url = $${n}`),o.push(r.avatar_url),n++),0===s.length)throw Error("沒有要更新的欄位");o.push(e);let i=`
    UPDATE users
    SET ${s.join(", ")}
    WHERE user_id = $${n}
    RETURNING user_id, email, name, avatar_url, created_at
  `;console.log("Executing query:",i),console.log("With values:",o);let l=await t.query(i,o);if(console.log("Query result:",l),0===l.rows.length)throw Error("找不到該使用者");return l.rows[0]}[a]=s.then?(await s)():s,e.s(["createUser",()=>n,"getUser",()=>o,"putUser",()=>i]),t()}catch(e){t(e)}},!1),39896,e=>e.a(async(r,t)=>{try{var a=e.i(69427),s=r([a]);async function o(e){try{let r=await e.json(),t=(0,a.putUser)(r.user_id,r);return Response.json(t)}catch(e){return console.error(e),Response.json({message:"Internal Server Error"})}}async function n(e){try{let r=await e.json();console.log("[API POST /api/aurora/user] Creating new user with data:",r);let t=await (0,a.createUser)(r);return console.log("[API POST /api/aurora/user] ✅ User created successfully:",t),Response.json(t)}catch(e){return console.error("[API POST /api/aurora/user] ❌ Error creating user:",e),Response.json({message:"Internal Server Error"})}}async function i(e){try{let r=new URL(e.url).searchParams.get("id");if(console.log("[API GET /api/aurora/user] Querying user with email:",r),!r)return Response.json({message:"Missing id"});let t=await (0,a.getUser)(r);if(t)return console.log("[API GET /api/aurora/user] ✅ User found:",t),Response.json(t);return console.log("[API GET /api/aurora/user] ⚠️ User not found for email:",r),Response.json(null)}catch(e){return console.error("[API GET /api/aurora/user] ❌ Error:",e),Response.json({message:"Internal Server Error"})}}[a]=s.then?(await s)():s,e.s(["GET",()=>i,"POST",()=>n,"PUT",()=>o]),t()}catch(e){t(e)}},!1),26751,e=>e.a(async(r,t)=>{try{var a=e.i(47909),s=e.i(74017),o=e.i(96250),n=e.i(59756),i=e.i(61916),l=e.i(14444),u=e.i(37092),c=e.i(69741),d=e.i(16795),p=e.i(87718),h=e.i(95169),g=e.i(47587),v=e.i(66012),m=e.i(70101),w=e.i(26937),R=e.i(10372),f=e.i(93695);e.i(52474);var E=e.i(220),x=e.i(39896),y=r([x]);[x]=y.then?(await y)():y;let P=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/aurora/user/route",pathname:"/api/aurora/user",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/aurora/user/route.ts",nextConfigOutput:"",userland:x}),{workAsyncStorage:U,workUnitAsyncStorage:C,serverHooks:A}=P;function _(){return(0,o.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:C})}async function T(e,r,t){P.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/aurora/user/route";a=a.replace(/\/index$/,"")||"/";let o=await P.prepare(e,r,{srcPage:a,multiZoneDraftMode:!1});if(!o)return r.statusCode=400,r.end("Bad Request"),null==t.waitUntil||t.waitUntil.call(t,Promise.resolve()),null;let{buildId:x,params:y,nextConfig:_,parsedUrl:T,isDraftMode:U,prerenderManifest:C,routerServerContext:A,isOnDemandRevalidate:I,revalidateOnlyGenerated:N,resolvedPathname:b,clientReferenceManifest:j,serverActionsManifest:S}=o,O=(0,c.normalizeAppPath)(a),D=!!(C.dynamicRoutes[O]||C.routes[b]),k=async()=>((null==A?void 0:A.render404)?await A.render404(e,r,T,!1):r.end("This page could not be found"),null);if(D&&!U){let e=!!C.routes[b],r=C.dynamicRoutes[O];if(r&&!1===r.fallback&&!e){if(_.experimental.adapterPath)return await k();throw new f.NoFallbackError}}let q=null;!D||P.isDev||U||(q=b,q="/index"===q?"/":q);let $=!0===P.isDev||!D,H=D&&!$;S&&j&&(0,l.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:j,serverActionsManifest:S,serverModuleMap:(0,u.createServerModuleMap)({serverActionsManifest:S})});let M=e.method||"GET",B=(0,i.getTracer)(),G=B.getActiveScopeSpan(),F={params:y,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:t.waitUntil,onClose:e=>{r.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(r,t,a)=>P.onRequestError(e,r,a,A)},sharedContext:{buildId:x}},L=new d.NodeNextRequest(e),K=new d.NodeNextResponse(r),Q=p.NextRequestAdapter.fromNodeNextRequest(L,(0,p.signalFromNodeResponse)(r));try{let o=async e=>P.handle(Q,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let t=B.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=t.get("next.route");if(s){let r=`${M} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":r}),e.updateName(r)}else e.updateName(`${M} ${a}`)}),l=!!(0,n.getRequestMeta)(e,"minimalMode"),u=async n=>{var i,u;let c=async({previousCacheEntry:s})=>{try{if(!l&&I&&N&&!s)return r.statusCode=404,r.setHeader("x-nextjs-cache","REVALIDATED"),r.end("This page could not be found"),null;let a=await o(n);e.fetchMetrics=F.renderOpts.fetchMetrics;let i=F.renderOpts.pendingWaitUntil;i&&t.waitUntil&&(t.waitUntil(i),i=void 0);let u=F.renderOpts.collectedTags;if(!D)return await (0,v.sendResponse)(L,K,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),r=(0,m.toNodeOutgoingHttpHeaders)(a.headers);u&&(r[R.NEXT_CACHE_TAGS_HEADER]=u),!r["content-type"]&&e.type&&(r["content-type"]=e.type);let t=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,s=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:r},cacheControl:{revalidate:t,expire:s}}}}catch(r){throw(null==s?void 0:s.isStale)&&await P.onRequestError(e,r,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:I})},A),r}},d=await P.handleResponse({req:e,nextConfig:_,cacheKey:q,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:t.waitUntil,isMinimalMode:l});if(!D)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||r.setHeader("x-nextjs-cache",I?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),U&&r.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&D||p.delete(R.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||r.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,w.getCacheControlHeader)(d.cacheControl)),await (0,v.sendResponse)(L,K,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};G?await u(G):await B.withPropagatedContext(e.headers,()=>B.trace(h.BaseServerSpan.handleRequest,{spanName:`${M} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},u))}catch(r){if(r instanceof f.NoFallbackError||await P.onRequestError(e,r,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:I})}),D)throw r;return await (0,v.sendResponse)(L,K,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>_,"routeModule",()=>P,"serverHooks",()=>A,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>C]),t()}catch(e){t(e)}},!1),14277,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__56e7cf5d._.js"].map(r=>e.l(r))).then(()=>r(63152)))},93306,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__045059a3._.js","server/chunks/[root-of-the-server]__a1bc4740._.js"].map(r=>e.l(r))).then(()=>r(38788)))},14115,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__c1120e1e._.js"].map(r=>e.l(r))).then(()=>r(26709)))},9193,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__b378aca5._.js"].map(r=>e.l(r))).then(()=>r(1346)))},85365,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__b0b24298._.js"].map(r=>e.l(r))).then(()=>r(33073)))},52170,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__c6f768da._.js"].map(r=>e.l(r))).then(()=>r(23492)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__dee9a977._.js.map