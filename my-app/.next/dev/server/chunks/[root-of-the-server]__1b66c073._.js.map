{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/kw_yeh/Desktop/SpendingTracker/my-app/src/utils/getAurora.ts"],"sourcesContent":["import 'server-only';\nimport { DsqlSigner } from '@aws-sdk/dsql-signer';\nimport { Client, Pool } from 'pg';\n\nconst {\n  AURORA_DSQL_HOST,\n  AURORA_DSQL_PORT,\n  AURORA_DSQL_REGION,\n  AURORA_DSQL_DB,\n  AURORA_DSQL_USER,\n} = process.env;\n\nasync function getPassword() {\n  const signer = new DsqlSigner({\n    hostname: AURORA_DSQL_HOST!,\n    region: AURORA_DSQL_REGION!,\n    credentials: {\n      accessKeyId: process.env.AWS_ACCESS_KEY_ID!,\n      secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,\n    },\n  });\n  return await signer.getDbConnectAdminAuthToken();\n}\n\nexport async function getDb() {\n  const password = await getPassword();\n\n  const client = new Client({\n    host: AURORA_DSQL_HOST!,\n    port: Number(AURORA_DSQL_PORT ?? 5432),\n    user: AURORA_DSQL_USER!,\n    password,\n    database: AURORA_DSQL_DB!,\n    ssl: { rejectUnauthorized: true },\n  });\n\n  await client.connect();\n  return client;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,EACJ,gBAAgB,EAChB,gBAAgB,EAChB,kBAAkB,EAClB,cAAc,EACd,gBAAgB,EACjB,GAAG,QAAQ,GAAG;AAEf,eAAe;IACb,MAAM,SAAS,IAAI,sLAAU,CAAC;QAC5B,UAAU;QACV,QAAQ;QACR,aAAa;YACX,aAAa,QAAQ,GAAG,CAAC,iBAAiB;YAC1C,iBAAiB,QAAQ,GAAG,CAAC,qBAAqB;QACpD;IACF;IACA,OAAO,MAAM,OAAO,0BAA0B;AAChD;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM;IAEvB,MAAM,SAAS,IAAI,8GAAM,CAAC;QACxB,MAAM;QACN,MAAM,OAAO,oBAAoB;QACjC,MAAM;QACN;QACA,UAAU;QACV,KAAK;YAAE,oBAAoB;QAAK;IAClC;IAEA,MAAM,OAAO,OAAO;IACpB,OAAO;AACT"}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///Users/kw_yeh/Desktop/SpendingTracker/my-app/src/services/user.ts"],"sourcesContent":["import { getDb } from '@/utils/getAurora';\n\n/**\n * 根據 Email 查詢使用者\n */\nexport async function getUser(email: string): Promise<User | null> {\n  if (!email) {\n    throw new Error('缺少 Email 資訊');\n  }\n\n  const db = await getDb();\n\n  const query = `\n    SELECT \n      user_id,\n      email,\n      name,\n      created_at\n    FROM users\n    WHERE email = $1\n  `;\n\n  const result = await db.query(query, [email]);\n\n  if (result.rows.length === 0) {\n    return null;\n  }\n\n  return result.rows[0];\n}\n\n/**\n * 建立新使用者（明確指定 user_id）\n */\nexport async function createUser(data: User): Promise<User> {\n  const { user_id, email, name } = data;\n\n  if (!user_id || !email) {\n    throw new Error('缺少必要欄位');\n  }\n\n  const db = await getDb();\n\n  const query = `\n    INSERT INTO users (user_id, email, name)\n    VALUES ($1, $2, $3)\n    ON CONFLICT (user_id) DO NOTHING\n    RETURNING user_id, email, name, created_at\n  `;\n\n  const result = await db.query(query, [user_id, email, name]);\n\n  if (result.rows.length === 0) {\n    throw new Error('使用者 ID 已存在');\n  }\n\n  return result.rows[0];\n}\n\n/**\n * 更新使用者資料\n */\nexport async function putUser(\n  userId: number,\n  data: Partial<User>,\n): Promise<User> {\n  if (!userId) {\n    throw new Error('缺少使用者 ID');\n  }\n\n  const db = await getDb();\n\n  // 動態建構 SET 子句\n  const updates: string[] = [];\n  const values: any[] = [];\n  let paramIndex = 1;\n\n  if (data.email !== undefined) {\n    updates.push(`email = $${paramIndex}`);\n    values.push(data.email);\n    paramIndex++;\n  }\n\n  if (data.name !== undefined) {\n    updates.push(`name = $${paramIndex}`);\n    values.push(data.name);\n    paramIndex++;\n  }\n\n  if (updates.length === 0) {\n    throw new Error('沒有要更新的欄位');\n  }\n\n  values.push(userId);\n\n  const query = `\n    UPDATE users\n    SET ${updates.join(', ')}\n    WHERE user_id = $${paramIndex}\n    RETURNING user_id, email, name, created_at\n  `;\n\n  console.log('Executing query:', query);\n  console.log('With values:', values);\n\n  const result = await db.query(query, values);\n\n  console.log('Query result:', result);\n\n  if (result.rows.length === 0) {\n    throw new Error('找不到該使用者');\n  }\n\n  return result.rows[0];\n}\n\n/**\n * 刪除使用者\n */\nexport async function deleteUser(userId: number): Promise<{ user_id: number }> {\n  if (!userId) {\n    throw new Error('缺少使用者 ID');\n  }\n\n  const db = await getDb();\n\n  const query = `\n    DELETE FROM users\n    WHERE user_id = $1\n    RETURNING user_id\n  `;\n\n  const result = await db.query(query, [userId]);\n\n  if (result.rows.length === 0) {\n    throw new Error('找不到該使用者');\n  }\n\n  return result.rows[0];\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAKO,eAAe,QAAQ,KAAa;IACzC,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,KAAK,MAAM,IAAA,oIAAK;IAEtB,MAAM,QAAQ,CAAC;;;;;;;;EAQf,CAAC;IAED,MAAM,SAAS,MAAM,GAAG,KAAK,CAAC,OAAO;QAAC;KAAM;IAE5C,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;QAC5B,OAAO;IACT;IAEA,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAKO,eAAe,WAAW,IAAU;IACzC,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG;IAEjC,IAAI,CAAC,WAAW,CAAC,OAAO;QACtB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,KAAK,MAAM,IAAA,oIAAK;IAEtB,MAAM,QAAQ,CAAC;;;;;EAKf,CAAC;IAED,MAAM,SAAS,MAAM,GAAG,KAAK,CAAC,OAAO;QAAC;QAAS;QAAO;KAAK;IAE3D,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;QAC5B,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAKO,eAAe,QACpB,MAAc,EACd,IAAmB;IAEnB,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,KAAK,MAAM,IAAA,oIAAK;IAEtB,cAAc;IACd,MAAM,UAAoB,EAAE;IAC5B,MAAM,SAAgB,EAAE;IACxB,IAAI,aAAa;IAEjB,IAAI,KAAK,KAAK,KAAK,WAAW;QAC5B,QAAQ,IAAI,CAAC,CAAC,SAAS,EAAE,YAAY;QACrC,OAAO,IAAI,CAAC,KAAK,KAAK;QACtB;IACF;IAEA,IAAI,KAAK,IAAI,KAAK,WAAW;QAC3B,QAAQ,IAAI,CAAC,CAAC,QAAQ,EAAE,YAAY;QACpC,OAAO,IAAI,CAAC,KAAK,IAAI;QACrB;IACF;IAEA,IAAI,QAAQ,MAAM,KAAK,GAAG;QACxB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAI,CAAC;IAEZ,MAAM,QAAQ,CAAC;;QAET,EAAE,QAAQ,IAAI,CAAC,MAAM;qBACR,EAAE,WAAW;;EAEhC,CAAC;IAED,QAAQ,GAAG,CAAC,oBAAoB;IAChC,QAAQ,GAAG,CAAC,gBAAgB;IAE5B,MAAM,SAAS,MAAM,GAAG,KAAK,CAAC,OAAO;IAErC,QAAQ,GAAG,CAAC,iBAAiB;IAE7B,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;QAC5B,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAKO,eAAe,WAAW,MAAc;IAC7C,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,KAAK,MAAM,IAAA,oIAAK;IAEtB,MAAM,QAAQ,CAAC;;;;EAIf,CAAC;IAED,MAAM,SAAS,MAAM,GAAG,KAAK,CAAC,OAAO;QAAC;KAAO;IAE7C,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;QAC5B,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB"}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///Users/kw_yeh/Desktop/SpendingTracker/my-app/src/app/api/aurora/user/route.ts"],"sourcesContent":["import { createUser, getUser, putUser } from '@/services/user';\n\nexport async function PUT(req: Request) {\n  try {\n    const body = await req.json();\n    const result = putUser(body.user_id, body);\n    return Response.json(result);\n  } catch (error) {\n    console.error(error);\n    return Response.json({ message: 'Internal Server Error' });\n  }\n}\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json();\n    const result = createUser(body);\n    return Response.json(result);\n  } catch (error) {\n    console.error(error);\n    return Response.json({ message: 'Internal Server Error' });\n  }\n}\n\nexport async function GET(req: Request) {\n  try {\n    const url = new URL(req.url);\n    const queryParams = url.searchParams;\n    const id = queryParams.get('id');\n    if (!id) return Response.json({ message: 'Missing id' });\n    const result = await getUser(id);\n    if (result) return Response.json(result);\n    return Response.json({ message: 'User not found' });\n  } catch (error) {\n    console.error(error);\n    return Response.json({ message: 'Internal Server Error' });\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;;;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,SAAS,IAAA,oIAAO,EAAC,KAAK,OAAO,EAAE;QACrC,OAAO,SAAS,IAAI,CAAC;IACvB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;QAAwB;IAC1D;AACF;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,SAAS,IAAA,uIAAU,EAAC;QAC1B,OAAO,SAAS,IAAI,CAAC;IACvB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;QAAwB;IAC1D;AACF;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,cAAc,IAAI,YAAY;QACpC,MAAM,KAAK,YAAY,GAAG,CAAC;QAC3B,IAAI,CAAC,IAAI,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;QAAa;QACtD,MAAM,SAAS,MAAM,IAAA,oIAAO,EAAC;QAC7B,IAAI,QAAQ,OAAO,SAAS,IAAI,CAAC;QACjC,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;QAAiB;IACnD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;QAAwB;IAC1D;AACF"}}]
}