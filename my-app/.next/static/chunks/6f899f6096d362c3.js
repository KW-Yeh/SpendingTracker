(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,94271,e=>{"use strict";var r=e.i(43476);e.s(["Loading",0,e=>(0,r.jsxs)("svg",{className:"-ml-1 mr-3 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",...e,children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})])},64766,e=>{"use strict";var r=e.i(43476),t=e.i(94271),s=e.i(76877),a=e.i(61500),o=e.i(26732),l=e.i(18566),n=e.i(71645);e.s(["InviteConfirm",0,()=>{let{id:e}=(0,l.useParams)(),d=(0,l.useRouter)(),{config:i,loading:c}=(0,a.useUserConfigCtx)(),{syncGroup:x,groups:u}=(0,s.useGroupCtx)(),[b,m]=(0,n.useState)(null),[g,h]=(0,n.useState)(!0),[p,j]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(!e){j("無效的邀請連結"),h(!1);return}fetch(`/api/aurora/groups?id=${e}&type=single`).then(e=>e.json()).then(e=>{e&&e.length>0?m(e[0]):j("找不到該群組")}).catch(e=>{console.error("查詢群組失敗:",e),j("查詢群組失敗，請稍後再試")}).finally(()=>{h(!1)})},[e]);let y=(0,n.useCallback)(()=>{let e=window.location.pathname;(0,o.signIn)(void 0,{callbackUrl:e})},[]),f=(0,n.useCallback)(async()=>{if(!i?.user_id||!b?.account_id)return void alert("無法加入群組，缺少必要資訊");if(u.some(e=>e.account_id===b.account_id)){alert("您已經是該群組的成員了"),d.push("/group");return}h(!0);try{if(!(await fetch("/api/aurora/group/member",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account_id:b.account_id,user_id:i.user_id,role:"Viewer"})})).ok)throw Error("Failed to add group member");await x(i.user_id),alert("成功加入群組！"),d.push("/group")}catch(e){console.error("加入群組失敗:",e),alert("加入群組失敗，請稍後再試")}finally{h(!1)}},[i,b,u,x,d]);return g||c?(0,r.jsx)("div",{className:"m-auto",children:(0,r.jsx)(t.Loading,{className:"text-text size-10 animate-spin"})}):p||!b?(0,r.jsxs)("div",{className:"bg-background flex w-80 flex-col rounded-2xl border border-solid border-red-300 p-6 text-center shadow",children:[(0,r.jsx)("p",{className:"text-red-500",children:p||"無法載入群組資訊"}),(0,r.jsx)("button",{type:"button",onClick:()=>d.push("/group"),className:"mt-4 rounded bg-gray-500 px-4 py-2 text-white hover:bg-gray-600",children:"返回群組頁面"})]}):i?.user_id?(0,r.jsxs)("div",{className:"bg-background flex w-80 flex-col rounded-2xl border border-solid border-gray-300 pt-5 pb-4 shadow",children:[(0,r.jsxs)("h1",{className:"mb-6 w-full px-5 text-start text-lg sm:text-xl",children:["是否加入",(0,r.jsx)("strong",{className:"ml-2 font-bold",children:b.name}),"帳本？"]}),(0,r.jsxs)("div",{className:"px-5 pb-4",children:[(0,r.jsx)("p",{className:"mb-2 text-sm text-gray-600",children:"帳本資訊："}),(0,r.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3 text-sm",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"font-medium",children:"擁有者："}),b.owner_name||b.owner_email||"未知"]}),(0,r.jsxs)("p",{className:"mt-1",children:[(0,r.jsx)("span",{className:"font-medium",children:"成員數量："}),b.member_count||0," 人"]})]}),(0,r.jsxs)("p",{className:"mt-3 text-xs text-gray-500",children:["加入後您將成為 ",(0,r.jsx)("strong",{children:"Viewer"}),"（檢視者）角色"]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 border-t border-solid border-gray-300 px-4 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>d.push("/group"),className:"active:text-background hover:text-background rounded border border-solid border-red-500 px-6 py-1 text-red-500 transition-colors hover:bg-red-500 active:bg-red-500",children:"取消"}),(0,r.jsx)("button",{type:"button",onClick:f,disabled:g,className:"text-background rounded border border-solid border-green-500 bg-green-500 px-6 py-1 transition-colors hover:border-green-400 hover:bg-green-400 active:border-green-400 active:bg-green-400 disabled:cursor-not-allowed disabled:bg-gray-400 disabled:border-gray-400",children:g?"加入中...":"加入"})]})]}):(0,r.jsxs)("div",{className:"bg-background flex w-80 flex-col rounded-2xl border border-solid border-blue-300 p-6 text-center shadow",children:[(0,r.jsx)("h2",{className:"mb-4 text-lg font-bold",children:"需要登入"}),(0,r.jsxs)("p",{className:"mb-2 text-gray-600",children:["您收到了加入帳本",(0,r.jsx)("strong",{className:"mx-1 text-blue-600",children:b.name}),"的邀請"]}),(0,r.jsx)("p",{className:"mb-6 text-sm text-gray-500",children:"請先登入以繼續加入帳本"}),(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:y,className:"rounded bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-600",children:"前往登入"}),(0,r.jsx)("button",{type:"button",onClick:()=>d.push("/"),className:"text-sm text-gray-500 hover:text-gray-700",children:"返回首頁"})]})]})}])}]);